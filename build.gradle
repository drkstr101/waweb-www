plugins {
  id 'watheia.node-conventions'
}

tasks.register('buildClient', YarnTask) {
  args = [
    'nx',
    'build',
    'client-home',
    '--configuration=production',
    '--with-deps',
    '--no-graphqlTracing',
    '--prefixPaths',
    '--no-uglify'
  ]
}

tasks.register('buildServer', YarnTask) {
  args = [
    'nx',
    'build',
    'server-api',
    '--configuration=production',
    '--with-deps',
    '--extractLicenses',
    '--generatePackageJson',
    '--memoryLimit=512',
    '--optimization',
    '--outputPath=apps/server/api/dist',
    '--progress',
    '--no-sourceMap',
    '--statsJson',
    '--verbose'
  ]
}

build {
  dependsOn buildClient, buildServer
}
